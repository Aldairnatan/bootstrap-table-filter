/**
 * @author: Alexey Drapash
 * @webSite: http://askalione.github.io/bootstrap-table-filter/
 * @version: v1.0.0
 */
!function(t){"use strict";var e=t.fn.bootstrapTable.utils.sprintf,i=t.fn.bootstrapTable.utils.calculateObjectValue,l=function(e,i){var l="",r="";null!=i&&(l=t.trim(i.id),r=t.trim(i.text)),e.append(t("<option></option>").attr("value",l).text(r))},r=function(t){var e=t.$header;return t.options.height&&(e=t.$tableHeader),e},a=function(e){var i=r(e),l=i.find("table select, table input");e.options.filterValues=[],l.each(function(){e.options.filterValues.push({field:t(this).attr("name"),value:t(this).val()})})},s=function(e){var i=null,l=[],a=r(e),s=a.find("table select, table input");e.options.filterValues.length>0&&s.each(function(r,a){i=t(this).attr("name"),l=t.grep(e.options.filterValues,function(t){return t.field===i}),l.length>0&&(t(this).val(l[0].value),t(this).hasClass("filter-select")&&t(this).select2("val",l[0].value))})},o=function(e){var i={},l=r(e).find("select.filter-control, input.filter-control");return console.log("filters.length",l.length),l.each(function(){var e=t(this).attr("name"),l=t(this).val();i[e]=l}),console.log("param",i),[i]},n=function(e,i){var a=[],s=[],o=t('<tr class="filter"></tr>');t.each(e.columns,function(t,i){if(i.visible)if(i.filterType){var l=i.filterType.toLowerCase();i.searchable&&e.options.filterTemplates[l]&&(a[i.field]="<th>"+e.options.filterTemplates[l](e,i)+"</th>","datepicker"==l&&(s[i.field]=i.filterDatepickerOptions))}else a[i.field]="<th></th>"}),t.each(i.children().children(),function(e,i){i=t(i);var l=i.data("field");null!=a[l]&&void 0!==a[l]?o.append(a[l]):o.append("<th></th>")}),o.insertAfter(r(e).find("tr")),r(e).find("select.filter-select").length>0&&r(e).find("select.filter-select").each(function(){var e=t(this).data("searchable"),i=t(this).data("selectType");switch(i){case"url":var r=t(this).data("url");t(this).select2({width:"100%",minimumResultsForSearch:e?1:-1,ajax:{url:r,dataType:"json",quietMillis:250,results:function(t,e){return{results:t}}},escapeMarkup:function(t){return t}});break;case"var":var a=t(this).data("var"),s=window[a];l(t(this),null);for(var o in s)l(t(this),s[o]);t(this).select2({width:"100%",minimumResultsForSearch:e?1:-1})}}),r(e).find("input.filter-datepicker").length>0&&r(e).find("input.filter-datepicker").each(function(){t(this).datepicker(s[t(this).data("field")]).on("changeDate",function(e){t(e.currentTarget).keyup()})})};t.extend(t.fn.bootstrapTable.defaults,{filter:!1,filterValues:[],filterTemplates:{input:function(t,i){return e('<input type="text" class="form-control filter-control" name="%s_filter" style="width: 100%;" data-field="%s" %s>',i.field,i.field,i.filterDisabled?'disabled="disabled"':"")},select:function(t,i){if(void 0===i.filterData)return"";var l=e('id="%s" class="filter-select filter-control" name="%s_filter"  style="width: 100%;" data-placeholder="%s" data-searchable="%s" data-field="%s" %s',i.field+"filter"+(r(t).find(".filter-select").length+1),i.field,i.title,void 0!==i.filterSelectSearchable?i.filterSelectSearchable:!1,i.field,i.filterDisabled?'disabled="disabled"':""),a=i.filterData.substring(0,3),s=i.filterData.substring(4,i.filterData.length);switch(a){case"url":return e('<input type="hidden" value="" data-select-type="%s" data-url="%s" %s>',a,s,l);case"var":return e('<select data-select-type="%s" data-var="%s" %s></select>',a,s,l)}},datepicker:function(t,i){return e('<div class="input-group">    <input type="text"  placeholder="%s" class="form-control  filter-control filter-datepicker" name="%s_filter" data-field="%s" %s><span class="input-group-addon"><i class="fa fa-calendar"></i></span></div>',t.options.formatFilterDatepickerPlaceholder(),i.field,i.field,i.filterDisabled?'disabled="disabled"':"")},input_range:function(t,i){var l=e('<input type="text" class="form-control mb5 filter-control" name="%s_from_filter" style="width: 100%;" data-field="%s" %s>',i.field,i.field,i.filterDisabled?'disabled="disabled"':""),r=e('<input type="text" class="form-control filter-control" name="%s_to_filter" style="width: 100%;" data-field="%s" %s>',i.field,i.field,i.filterDisabled?'disabled="disabled"':"");return e("%s%s",l,r)},select_range:function(t,i){if(void 0!==i.filterData){var l=e('id="%s" style="width: 100%;" data-placeholder="-" data-searchable="%s" data-field="%s" %s',i.field+"filter"+(r(t).find(".filter-select").length+1),void 0!==i.filterSelectSearchable?i.filterSelectSearchable:!1,i.field,i.filterDisabled?'disabled="disabled"':""),a="",s="",o=i.filterData.substring(0,3),n=i.filterData.substring(4,i.filterData.length);switch(o){case"url":a=e('<input type="hidden" value="" class="filter-select mb5 filter-control" data-select-type="%s" name="%s_from_filter" data-url="%s" %s>',o,i.field,n,l),s=e('<input type="hidden" value="" class="filter-select filter-control" data-select-type="%s" name="%s_to_filter" data-url="%s" %s>',o,i.field,n,l);break;case"var":a=e('<select class="filter-select mb5 filter-control" data-select-type="%s" name="%s_from_filter" data-var="%s" %s></select>',o,i.field,n,l),s=e('<select class="filter-select mb5 filter-control" data-select-type="%s" name="%s_to_filter" data-var="%s" %s></select>',o,i.field,n,l)}return e("%s%s",a,s)}return""},datepicker_range:function(t,i){var l=e('<div class="input-group mb5">    <input type="text" placeholder="%s" class="form-control  filter-control filter-datepicker" name="%s_from_filter" data-field="%s" %s><span class="input-group-addon"><i class="fa fa-calendar"></i></span></div>',t.options.formatFilterDatepickerPlaceholderFrom(),i.field,i.field,i.filterDisabled?'disabled="disabled"':""),r=e('<div class="input-group">    <input type="text" placeholder="%s" class="form-control  filter-control filter-datepicker" name="%s_to_filter" data-field="%s" %s><span class="input-group-addon"><i class="fa fa-calendar"></i></span></div>',t.options.formatFilterDatepickerPlaceholderTo(),i.field,i.field,i.filterDisabled?'disabled="disabled"':"");return e("%s%s",l,r)}}}),t.extend(t.fn.bootstrapTable.defaults.icons,{filter:"fa-filter icon-filter",resetFilter:"fa-remove icon-reset-filter"}),t.extend(t.fn.bootstrapTable.locales["en-US"],{formatFilterDatepickerPlaceholder:function(){return"dd.mm.yyyy"},formatFilterDatepickerPlaceholderFrom:function(){return"from dd.mm.yyyy"},formatFilterDatepickerPlaceholderTo:function(){return"to dd.mm.yyyy"},formatFilter:function(){return"Start filter"},formatResetFilter:function(){return"Reset filter"}}),t.extend(t.fn.bootstrapTable.defaults,t.fn.bootstrapTable.locales),t.extend(t.fn.bootstrapTable.COLUMN_DEFAULTS,{filterType:void 0,filterData:void 0,filterSelectSearchable:!1,filterDatepickerOptions:{dateFormat:"dd.mm.yy"},filterDisabled:!1});var f=t.fn.bootstrapTable.Constructor,c=f.prototype.init,d=f.prototype.initToolbar,p=f.prototype.initHeader,u=f.prototype.fitHeader,h=f.prototype.refresh;f.prototype.init=function(){if(this.options.filter){var t=this;this.$el.on("reset-view.bs.table",function(){t.options.height&&s(t)})}c.apply(this,Array.prototype.slice.apply(arguments))},f.prototype.initHeader=function(){p.apply(this,Array.prototype.slice.apply(arguments)),this.options.filter&&(this.options.height||(n(this,this.$header),this.$tableLoading.css("top",this.$header.outerHeight()+1)))},f.prototype.fitHeader=function(){u.apply(this,Array.prototype.slice.apply(arguments)),this.options.filter&&(n(this,this.$header),s(this),this.$tableLoading.css("top",this.$tableHeader.outerHeight()+1))},f.prototype.refresh=function(e){if(this.options.filter){var l=i(this.options,this.$el.data("queryParams"),o(this),[]);this.options.queryParams=function(e){return t.extend(e,l),e},this.options.height&&a(this)}h.apply(this,Array.prototype.slice.apply(arguments))},f.prototype.initToolbar=function(){if(!this.showToolbar&&this.options.filter&&(this.showToolbar=this.options.filter),d.apply(this,Array.prototype.slice.apply(arguments)),this.options.filter){var i=t('<div class="columns columns-right btn-group pull-right"></div>'),l=t(['<button class="btn btn-default" ',e('type="button" title="%s">',this.options.formatFilter()),e('<i class="%s %s"></i> ',this.options.iconsPrefix,this.options.icons.filter),"</button>","</ul>"].join("")).appendTo(i),r=t(['<button class="btn btn-default" ',e('type="button" title="%s">',this.options.formatResetFilter()),e('<i class="%s %s"></i> ',this.options.iconsPrefix,this.options.icons.resetFilter),"</button>","</ul>"].join("")).appendTo(i);i.appendTo(this.$toolbar),l.off("click").on("click",t.proxy(this.refresh,this)),r.off("click").on("click",t.proxy(this.resetFilter,this))}},f.prototype.resetFilter=function(){if(this.options.filter){var e=[];t.each(this.options.filterValues,function(t,e){e.value=""}),s(this),e=r(this).find("input.filter-control"),e.each(function(){t(this).val("")}),e=r(this).find("select.filter-control"),e.each(function(){t(this).select2("val","")}),this.refresh()}}}(jQuery);